# SpikeHunter 모델 성능 개선 프로젝트 요약 보고서

**문서 작성일**: 2025년 10월 8일
**작성자**: Gemini (AI Assistant)

## 1. 프로젝트 목표

본 프로젝트의 최종 목표는 **'실제 투자에 적용 가능한 수준의 신뢰도를 가진 급등주 예측 모델 개발'**입니다.

이를 달성하기 위한 핵심 과제는, 잘못된 매수 신호(False Positive)를 최소화하여 **정밀도(Precision)를 유의미한 수준(0.5 이상 목표)까지 끌어올리는 것**과, 동시에 급등 기회를 놓치지 않는 **포착 능력(Recall)을 일정 수준 이상으로 유지**하는 균형 잡힌 모델을 만드는 것입니다.

---

## 2. 초기 모델 진단 및 현실적인 성능 기준선 확립

프로젝트 초기, 모델은 단순 Train/Test 분할 방식으로 평가되었으며, 이때 **정밀도 0.51**이라는 높은 수치를 기록했습니다.

하지만 이 방식은 시계열 데이터의 특성을 무시하여 미래의 정보로 과거를 예측하는 **'데이터 유출(Data Leakage)'** 문제가 발생, 성능이 비현실적으로 좋게 측정되었습니다.

보다 현실적인 성능 측정을 위해 **시계열 교차검증(Time Series Cross-Validation)**을 도입했으며, 이를 통해 모델의 정직한 성능, 즉 **'평균 정밀도 0.15'** 라는 신뢰할 수 있는 **성능 기준선(Baseline)**을 최초로 확보했습니다. 이후의 모든 개선 작업은 이 기준선을 바탕으로 진행되었습니다.

---

## 3. 주요 해결 과제 및 개선 과정 (Problem & Solution)

신뢰도 높은 기준선 위에서, 모델의 성능을 체계적으로 개선하기 위해 다음과 같은 과제들을 순차적으로 해결했습니다.

### 3.1. 데이터 파이프라인 안정화

개발 과정에서 발생한 여러 데이터 관련 오류를 해결하여 안정적인 실험 환경을 구축했습니다.

-   **문제**: 피처 생성(`derive.py`) 중 `SettingWithCopyWarning` 및 `ValueError` 발생.
-   **해결**: `df.copy()`를 명시적으로 사용하여 데이터프레임 복사본 관련 오류를 원천적으로 차단했습니다.

-   **문제**: MACD 피처 추가 후, 결측치(`NaN`)로 인해 학습 데이터가 대량 유실되는 현상 발생.
-   **해결**: MACD 계산 로직 직후 `.fillna(0)` 처리를 추가하여 데이터 유실을 방지했습니다.

-   **문제**: `collect.py`와 `addon_price_sanitizer.py` 간의 데이터 규격(컬럼) 불일치로 인한 오류.
-   **해결**: `collect.py`에 표준 컬럼 목록(`REQUIRED_RAW_COLS`)을 상수로 정의하고, 다른 모듈이 이를 참조하도록 코드를 리팩토링하여 시스템 전체의 데이터 일관성을 확보했습니다.

### 3.2. 분류 모델 성능 최적화

안정화된 파이프라인 위에서 모델의 예측력을 극대화하기 위한 실험을 진행했습니다.

-   **과제 1: 최적 학습 기간 탐색**
    -   **시도**: 전체 기간 → 최근 2년 → 최근 1년으로 학습 데이터 범위를 좁혀가며 성능 변화를 관찰했습니다.
    -   **결론**: **최근 1년**의 데이터만 사용했을 때, 모델이 최신 시장 패턴에 집중하여 가장 효율적이고 우수한 성능(AUC, F1-Score 등)을 보임을 확인했습니다.

-   **과제 2: 샘플링 기법 고도화**
    -   **시도**: 기존 `SMOTE` 방식이 높은 재현율에 비해 낮은 정밀도를 보이는 문제를 해결하기 위해, 노이즈 제거 기능이 포함된 **`SMOTEENN`**을 도입했습니다.
    -   **결론**: **`SMOTEENN` 적용 후, 재현율을 크게 희생하지 않으면서도 정밀도와 특이도(Specificity)가 동시에 상승**하는 의미 있는 개선을 확인했습니다. 이는 모델이 더 명확한 결정 경계를 학습했음을 의미합니다.

-   **과제 3: 최적 예측 임계값(Threshold) 탐색**
    -   **시도**: 모델의 예측 확률을 0 또는 1로 변환하는 기준점(임계값)을 0.01 ~ 0.001 단위로 세분화하여 테스트하며 정밀도와 재현율의 변화를 추적했습니다.
    -   **결론**: F1-Score가 가장 높은 지점을 찾아, 현재 모델(1년 학습, SMOTEENN)의 **최적 운영 임계값이 `0.506`** 임을 실험적으로 규명했습니다.

### 3.3. ML 최적화 파이프라인 개선

Optuna를 사용한 하이퍼파라미터 최적화 과정의 여러 버그를 수정하고 기능을 개선했습니다.

-   **문제**: 평가 지표 확장으로 인한 `KeyError` 발생.
-   **해결**: 최적화 Objective 로직을 수정하여, 변경된 평가 함수의 반환 값 구조에 맞게 점수를 정상적으로 가져오도록 수정했습니다.

-   **기능 개선**:
    -   모든 시장 체제(R1, R2, R3)를 순차적으로 최적화하는 메뉴를 추가했습니다.
    -   `R1` 체제에서 최적화된 `max_market_vol` 값을 다른 체제들이 공유하도록 로직을 수정하여, 전략의 일관성을 확보했습니다.
    -   최적화 결과가 기존보다 개선되었을 때만 자동으로 설정을 업데이트하도록 하여 안정성을 높였습니다.

---

## 4. 최종 모델 및 성과 (2025-10-08 기준)

-   **최적 구성**: `학습 기간: 최근 1년`, `샘플링: SMOTEENN`, `운영 임계값: 0.506`
-   **최종 성능 (교차검증 평균)**:
    -   **Precision: 0.1789**
    -   **Recall: 0.7658**
    -   **F1-Score: 0.2877**
    -   **Average Precision: 0.1933**

초기 현실적인 기준선(정밀도 0.15)과 비교했을 때, **정밀도를 포함한 모든 핵심 지표가 상승**했으며, 특히 **Average Precision이 크게 향상**되어 모델의 근본적인 예측력이 개선되었음을 확인했습니다.

---

## 5. 결론 및 향후 과제

### 5.1. 결론

본 프로젝트는 신뢰할 수 있는 평가 체계를 구축하고, 데이터 파이프라인을 안정화했으며, 학습 데이터와 샘플링 기법, 임계값 조정을 통해 **모델의 성능을 체계적으로 개선하는 데 성공**했습니다. 비록 목표치인 정밀도 0.5에는 도달하지 못했지만, 훨씬 더 안정적이고 강력한 베이스라인 모델을 확보하는 성과를 거두었습니다.

### 5.2. 향후 과제

정밀도 0.5 이상이라는 도전적인 목표를 달성하기 위해, 다음과 같은 장기적인 과제를 추진할 것을 권고합니다.

1.  **피처 엔지니어링 (Feature Engineering)**: 현재 성능을 한 단계 더 도약시키기 위한 가장 중요한 과제입니다. 변별력 높은 새로운 피처를 추가하거나, 중요도가 낮은 피처를 제거하여 모델이 학습하는 정보의 질을 높여야 합니다.
2.  **모델 다각화**: LightGBM 외에 XGBoost, CatBoost 등 다른 알고리즘을 테스트하거나, 여러 모델을 결합하는 앙상블 기법을 도입하여 성능 향상을 모색할 수 있습니다.