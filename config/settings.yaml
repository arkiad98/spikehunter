# config/settings.yaml (Restore Point: AP 0.18 Version + CatBoost)

# 1. 기본 설정
top_n: 5
min_avg_value: 1000000000
fee_rate: 0.0015

backtest_defaults:
  initial_cash: 10000000.0
  default_years: 5
  min_ml_target_return: 0.03

walk_forward:
  total_start_date: '2020-01-01'
  train_months: 24
  test_months: 6

paths:
  raw_prices: d:/spikehunter/data/raw/prices
  raw_fundflow: d:/spikehunter/data/raw/fundflow
  raw_index: d:/spikehunter/data/raw/index
  merged: d:/spikehunter/data/proc/merged
  features: data/proc/features
  backtest: data/proc/backtest
  predictions: data/proc/predictions
  ml_dataset: data/proc/ml_dataset
  models: data/models
  meta: data/meta
  cache: data/cache

# 2. 머신러닝 파라미터 (이 부분이 중요!)
ml_params:
  # [복구] 타겟 기준을 10%로 완화하여 데이터 확보 (15%는 너무 적었음)
  target_surge_rate: 0.1344928226333169
  stop_loss_rate: -0.05686049805983242 # [신규] 학습/백테스트 통일
  target_hold_period: 5
  regression_sampling_quantile: 0.9
  classification_train_months: 36
  classification_threshold: 0.7448009471330749

  # [복구] 검증된 Golden Params (AP 0.18 달성 당시)
  lgbm_params_classification:
    objective: binary
    metric: average_precision
    scale_pos_weight: 4.743379678262101  # [수정] Natural Learning (No Weight)
    n_estimators: 1313
    learning_rate: 0.005364725521057287
    num_leaves: 21
    max_depth: 11
    colsample_bytree: 0.6471185057450073
    subsample: 0.7046077526129331
    n_jobs: 4
    verbose: -1

    # [기존] LightGBM용 파라미터 공간
    param_space_lgbm:
      learning_rate: {type: float, low: 0.005, high: 0.15, log: true}
      num_leaves: {type: int, low: 20, high: 200}
      max_depth: {type: int, low: 4, high: 20}
      n_estimators: {type: int, low: 300, high: 3000}
      scale_pos_weight: {type: float, low: 1.0, high: 5.0}
      colsample_bytree: {type: float, low: 0.5, high: 1.0}
      subsample: {type: float, low: 0.5, high: 1.0}
      min_child_samples: {type: int, low: 10, high: 100}
    min_child_samples: 98

  # [NEW] XGBoost 파라미터
  xgb_params_classification:
    objective: binary:logistic
    eval_metric: logloss
    n_estimators: 603
    learning_rate: 0.012649564995901032
    max_depth: 6
    subsample: 0.9790590277960377
    colsample_bytree: 0.8082325218691137
    scale_pos_weight: 2.190777004972905
    n_jobs: 4
    random_state: 42
    tree_method: hist
    min_child_weight: 10
    gamma: 0.19007214421560437

    # [추가] XGBoost용 파라미터 공간
    param_space_xgb:
      learning_rate: {type: float, low: 0.01, high: 0.2, log: true}
      max_depth: {type: int, low: 4, high: 12}
      n_estimators: {type: int, low: 500, high: 2000}
      scale_pos_weight: {type: float, low: 1.0, high: 4.0}
      min_child_weight: {type: int, low: 1, high: 10}
      gamma: {type: float, low: 0.0, high: 0.5}
      subsample: {type: float, low: 0.6, high: 1.0}
      colsample_bytree: {type: float, low: 0.6, high: 1.0}

  # [NEW] CatBoost 파라미터
  cat_params_classification:
    iterations: 795
    learning_rate: 0.020107281929641285
    depth: 6
    l2_leaf_reg: 2.3706494739674833
    loss_function: Logloss
    eval_metric: AUC
    random_seed: 42
    verbose: 0
    thread_count: 4
    allow_writing_files: false

    # [추가] CatBoost용 파라미터 공간
    param_space_cat:
      learning_rate: {type: float, low: 0.01, high: 0.2, log: true}
      depth: {type: int, low: 4, high: 10}
      iterations: {type: int, low: 500, high: 2000}
      l2_leaf_reg: {type: float, low: 1.0, high: 10.0}
      border_count: {type: int, low: 32, high: 255}
      random_strength: {type: float, low: 0.0, high: 10.0}
    border_count: 159
    random_strength: 0.5607904698110447

# 4. 전략 최적화 설정
optimization:
  SpikeHunter_R1_BullStable:
    optimize_on: Sharpe_raw
    n_trials: 100
    param_space:
      target_r: {type: float, low: 0.10, high: 0.30}
      stop_r: {type: float, low: -0.10, high: -0.05}
      min_ml_score: {type: float, low: 0.60, high: 0.90}
      max_market_vol: {type: float, low: 0.015, high: 0.04}
      vbo_k: {type: float, low: 0.3, high: 0.7}
      min_mfi: {type: float, low: 40.0, high: 60.0}

# 5. 전략 설정
strategies:
  SpikeHunter_R1_BullStable:
    name: SpikeHunter_R1_BullStable
    target_r: 0.1344928226333169  # [수정] ml_params와 통일 (0.13 -> 0.10)
    stop_r: -0.05686049805983242  # [수정] ml_params와 통일
    max_hold: 5
    min_ml_score: 0.7448009471330749 # [수정] ml_params.classification_threshold와 통일
    vbo_k: 0.38372585092556344
    max_market_vol: 0.03972917789908604
    min_mfi: 49.946337192993994
    min_obv_slope: 0
    top_n: 5
